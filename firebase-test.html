<!DOCTYPE html>
<html>

<head>
    <title>Test Notificaciones Firebase</title>
    <meta charset="UTF-8">
</head>

<body>
    <h1>üîî Test de Notificaciones Push</h1>
    <button onclick="requestPermission()" style="padding: 15px 30px; font-size: 18px; cursor: pointer;">
        Solicitar Permiso y Obtener Token
    </button>
    <div id="result" style="margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 5px;">
        <p><strong>Token FCM:</strong></p>
        <p id="token" style="word-break: break-all; font-family: monospace; font-size: 12px;">
            Haz clic en el bot√≥n para obtener el token
        </p>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getMessaging, getToken } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js';

        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDLHG_KSyaFhobi74qG3y98hmzFje-XJu8",
            authDomain: "bol-food-bot.firebaseapp.com",
            projectId: "bol-food-bot",
            storageBucket: "bol-food-bot.firebasestorage.app",
            messagingSenderId: "729502275382",
            appId: "1:729502275382:web:6497ae278694b0e3fbc597"
        };

        const app = initializeApp(firebaseConfig);
        const messaging = getMessaging(app);

        window.requestPermission = async function () {
            try {
                // Registrar Service Worker primero
                const registration = await navigator.serviceWorker.register('/firebase-messaging-sw.js');
                console.log('Service Worker registrado:', registration);

                // Esperar a que el Service Worker est√© activo
                await navigator.serviceWorker.ready;
                console.log('Service Worker activo');

                // Solicitar permiso de notificaciones
                const permission = await Notification.requestPermission();
                console.log('Permiso:', permission);

                if (permission === 'granted') {
                    // Obtener token FCM
                    const token = await getToken(messaging, {
                        vapidKey: 'BNb5hOOhMwlsMJ-OoISO-_JJY2zgO0WaON4V_Q7rRbM80ZX02_BvXGrJ5sKim7NSZASxk7qAX_vJDfyr8Zlg5Y4',
                        serviceWorkerRegistration: registration
                    });

                    document.getElementById('token').textContent = token;
                    console.log('‚úÖ Token FCM obtenido:', token);
                    alert('‚úÖ Token obtenido! C√≥pialo de abajo.');
                } else {
                    alert('‚ùå Permiso denegado. Por favor, permite las notificaciones en la configuraci√≥n del navegador.');
                }
            } catch (error) {
                console.error('‚ùå Error completo:', error);
                alert('Error: ' + error.message + '\n\nRevisa la consola para m√°s detalles.');
            }
        }
    </script>
</body>

</html>